🧩 一、总体定位

“本地可复现的 AI 实验空间”
用 Next.js + p5.js + JSON 文件导出 构建一个无数据库、可分叉、可回放的 Web 应用。

⸻

⚙️ 二、技术栈结构

模块	技术栈选择	说明
前端框架	Next.js (App Router) + TypeScript	稳定、易部署，未来可平滑迁移到带后端版本（Supabase/Edge）。
渲染层	p5.js (WEBGL 模式)	实现弥散球的核心视觉。参数与状态解耦，渲染只读。
UI 层	TailwindCSS + shadcn/ui	快速出干净、统一的界面（滑块、面板、分支树）。
状态管理	Zustand 或 Jotai	轻量、函数式状态；支持快照、时间旅行与事件回放。
本地数据存储	内存 + JSON 导出（MVP）可选：Dexie (IndexedDB)	MVP 阶段全本地运行；支持导出/导入 .json 或 .anicca 包。
文件压缩与导出	JSZip	将 project.json + thumbs/* 打包下载。
图形文件加载	p5.File / fetch / FileReader API	支持本地导入 JSON 或 zip。
提示词模板管理	JSON 模板 + Mustache/Handlebars	用变量填充的“抬杠 / 深思”模板系统。
版本控制（分支）	自定义 DAG 模型（Node + Branch + Event）	不依赖数据库，直接序列化为 JSON 存储。
可视化组件	react-force-graph / D3.js (可选)	用于展示节点/分支关系图。
截图/视频输出	p5.toDataURL() / WebCodecs API (可选)	保存每次渲染结果缩略图。
类型与 Schema 验证	Zod / TypeScript 类型	校验导入的 JSON 文件合法性。


⸻

🧱 三、架构分层（从下到上）

┌────────────────────────────────────┐
│             UI 层                  │
│  shadcn/ui + Tailwind + React Hooks │
│   ├── 左栏：Branch 树 / 历史列表     │
│   ├── 中栏：p5 Canvas               │
│   └── 右栏：Prompt / 参数 / 日志    │
├────────────────────────────────────┤
│           状态与逻辑层              │
│  Zustand store（nodes / branches）  │
│   ├── commit() 生成新 node          │
│   ├── fork() / merge() 分支操作     │
│   └── exportJSON() / importJSON()   │
├────────────────────────────────────┤
│             渲染层                  │
│  p5.js (WEBGL)                      │
│   ├── 读取当前 node.params          │
│   ├── 实时渲染弥散球               │
│   └── 输出截图与性能指标            │
├────────────────────────────────────┤
│         存储与导出层                │
│  内存 + JSON 文件 / JSZip 打包      │
│   ├── 自动保存 localStorage (可选)  │
│   └── 导入/导出 project.json/.zip   │
└────────────────────────────────────┘


⸻

🧠 四、关键设计哲学

主题	说明
无后端可复现性	每个 Node 是独立快照，导出 JSON 即可复现完整实验。
事件溯源思想	任何改动都生成新 Node（不可变），形成分支树。
轻量上下文	只缓存 summary + diff，不依赖长上下文聊天串。
Prompt 模板化	“抬杠/深思”都通过模板版本化，可变量填充。
渐进式演化	后续若上云，只需替换导出导入逻辑为 API 调用。


⸻

💡 五、可选增强（未来版本）
	•	Worker 化 p5 渲染（OffscreenCanvas）
	•	语义检索（用 local embedding + cosine）
	•	分支对比视图（参数 diff + 结果图滑动对比）
	•	.anicca 多文件包（manifest + nodes + thumbs）
	•	Cloud save 模式（接 Supabase / Cloudflare R2）

⸻

✅ 六、最小可行技术清单（可直接上手）

分类	库名	版本建议
框架	next	^15
状态	zustand	^4.5
UI	tailwindcss, @shadcn/ui	^3.x
渲染	p5	^1.10
工具	jszip, file-saver, uuid	最新
模板	mustache	^4.2
类型	zod	^3.23


⸻

🌕 总结一句话：

MVP 技术栈 =
Next.js + p5.js + Zustand + Tailwind + JSON 导出 + JSZip
→ 全本地运行、可导出复现、天然支持分支与上下文缓存。

⸻